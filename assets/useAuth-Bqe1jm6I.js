import{r as e}from"./react-vendor-CHLR6qIU.js";import{a as f,o as S,q as y,c as A,w,g as E}from"./firebase-A1TrhjMY.js";import{d as F}from"./firebaseConfig-CKbRA7LN.js";const D=()=>{const[n,s]=e.useState(null),[c,r]=e.useState(null),[i,l]=e.useState(!0),[d,m]=e.useState(null);return e.useEffect(()=>{const h=f(),p=S(h,async t=>{if(l(!0),t)try{const o=t.uid||localStorage.getItem("uid");localStorage.setItem("uid",o);const g=y(A(F,"employees"),w("uid","==",o)),a=await E(g);if(a.empty)console.warn("⚠️ No profile found in Firestore for uid:",o),s({uid:t.uid,email:t.email}),r("user");else{const u=a.docs[0].data();console.log("✔️ Firestore user:",u),s({uid:t.uid,email:t.email,...u}),r(u.role||"user")}}catch(o){console.error("Auth Firestore error:",o),m("Failed to load profile data"),s(null)}else s(null),r(null);l(!1)});return()=>p()},[]),{user:n,role:c,loading:i,authError:d}};export{D as u};
