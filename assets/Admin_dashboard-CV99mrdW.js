import{r as p,j as e}from"./react-vendor-DXKxfpO9.js";import{d as g,i as L,e as O}from"./vendor-h5GNKu5a.js";import{u as P}from"./useEmployees-CG4yn2Yf.js";import{u as T}from"./useAttendance-BfXbuFO3.js";import"./firebase-DiQNaKJt.js";import"./firebaseConfig-D3QKFph8.js";const U=({data:t,orientation:d="horizontal"})=>{const[b,u]=p.useState([]);return p.useEffect(()=>{const r=setInterval(()=>{u(n=>t.map((o,i)=>Math.min(((n==null?void 0:n[i])||0)+1,o.percentage)))},20);return()=>clearInterval(r)},[t]),e.jsx("div",{className:"p-6",children:d==="horizontal"?e.jsx("div",{children:t.map((r,n)=>{var c;const o=(c=r.name)==null?void 0:c.split("_").map(m=>m.charAt(0).toUpperCase()+m.slice(1)).join(" "),i=b[n]||0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:o}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i,"%"]})]}),e.jsx("div",{className:"relative w-full bg-gray-100 h-4 rounded-xl overflow-hidden",children:e.jsx("div",{className:`absolute top-0 left-0 h-full transition-all duration-500 ease-in-out bg-gradient-to-r from-blue-400 via-${r.color.replace("bg-","")} to-blue-600`,style:{width:`${i}%`}})})]},n)})}):e.jsx("div",{className:"flex items-end gap-6 w-full h-[300px] overflow-x-auto",children:t.map((r,n)=>{var c;const o=(c=r.name)==null?void 0:c.split("_").map(m=>m.charAt(0).toUpperCase()+m.slice(1)).join(" "),i=b[n]||0;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-10 rounded-t-xl transform origin-bottom transition-transform duration-700 bg-gradient-to-t ${R(r.color)}`,style:{transform:`scaleY(${i/100})`,height:"250px"}}),e.jsx("span",{className:"text-sm mt-2 text-center text-gray-600 w-[100px] truncate",children:o}),e.jsxs("span",{className:"text-xs text-gray-400",children:[i,"%"]})]},n)})})})},R=t=>({"bg-green-500":"from-green-400 via-green-500 to-green-600","bg-blue-500":"from-blue-400 via-blue-500 to-blue-600","bg-purple-500":"from-purple-400 via-purple-500 to-purple-600","bg-yellow-500":"from-yellow-400 via-yellow-500 to-yellow-600","bg-pink-500":"from-pink-400 via-pink-500 to-pink-600","bg-indigo-500":"from-indigo-400 via-indigo-500 to-indigo-600"})[t]||"from-gray-300 via-gray-400 to-gray-500";g.extend(L);g.extend(O);const H={general:["08:30","09:00","09:30","10:00"],"shift-1":["06:00","07:00"],"shift-2":["13:00","14:00"]},z=t=>t.map(d=>{var c,m,v;const b=(c=d.shift)==null?void 0:c.toLowerCase(),u=H[b],r=(v=(m=d.tracker)==null?void 0:m[0])==null?void 0:v.clockIn;if(!u||!r)return{...d,status:"Unknown"};const n=g().format("YYYY-MM-DD"),o=g(`${n} ${r}`,"YYYY-MM-DD HH:mm:ss"),i=u.some(D=>{const N=g(`${n} ${D}`,"YYYY-MM-DD HH:mm"),a=N.subtract(10,"minute"),h=N.add(5,"minute");return o.isSameOrAfter(a)&&o.isSameOrBefore(h)});return{...d,status:i?"On time":"Late"}}),K=()=>{const{employees:t}=P(),{getAllAttendance:d}=T(),[b,u]=p.useState([]),[r,n]=p.useState([]),[o,i]=p.useState(0),[c,m]=p.useState(0),[v,D]=p.useState(0);p.useEffect(()=>{(async()=>{try{const h=await d();u(h);const w=g().format("YYYY-MM-DD"),f=h.filter(s=>g(s.date).format("YYYY-MM-DD")===w),Y=new Set;if(f.forEach(s=>{var l;((l=s.tracker)==null?void 0:l.some(y=>y.clockIn&&y.clockIn!=="--:--:--"))&&Y.add(s.employeeId)}),i(Y.size),t!=null&&t.length){const x=[...new Set(t.map(l=>l.employeeid))].filter(l=>!Y.has(l)).length;m(x)}const j={};t.forEach(s=>{var l;const x=((l=s.department)==null?void 0:l.trim())||"Unassigned";j[x]||(j[x]={name:x,present:0,total:0}),j[x].total+=1});const S=new Set;f.forEach(s=>{var I,M;if(!((I=s.tracker)==null?void 0:I.some(k=>k.clockIn&&k.clockIn!=="--:--:--")))return;const l=t.find(k=>String(k.employeeid)===String(s.employeeId));if(!l)return;const y=l.employeeid;if(S.has(y))return;S.add(y);const C=((M=l.department)==null?void 0:M.trim())||"Unassigned";j[C]&&(j[C].present+=1)});const $=z(f).filter(s=>s.status==="Late");D($.length);const A=["bg-green-500","bg-blue-500","bg-purple-500","bg-yellow-500","bg-pink-500","bg-indigo-500"],E=Object.values(j).map((s,x)=>({...s,percentage:s.total>0?Math.round(s.present/s.total*100):0,color:A[x%A.length]}));n(E)}catch(h){console.error("Attendance fetch error:",h)}})()},[d,t]);const N=[{title:"Total Employees",value:(t==null?void 0:t.length)||0,icon:"bx-group",trend:"+5% from last month",color:"bg-blue-100 text-blue-600"},{title:"Present Today",value:o,icon:"bx-check-circle",trend:`${Math.round(o/((t==null?void 0:t.length)||1)*100)}% attendance`,color:"bg-green-100 text-green-600"},{title:"On Leave",value:c,icon:"bx-calendar-x",trend:c>0?`${c} not clocked in`:"Full attendance",color:"bg-yellow-100 text-yellow-600"},{title:"Late Arrivals",value:v,icon:"bx-time-five",trend:`${Math.round(v/(o||1)*100)}% of present`,color:"bg-red-100 text-red-600"}];return e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:N.map((a,h)=>e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:a.title}),e.jsx("h3",{className:"text-2xl font-bold mt-1",children:a.value}),e.jsx("p",{className:`text-sm ${a.color.replace("bg-","text-")} mt-1`,children:a.trend})]}),e.jsx("div",{className:`${a.color} p-3 rounded-full`,children:e.jsx("i",{className:`bx ${a.icon} text-2xl`})})]})},h))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Attendance Overview"}),e.jsxs("select",{className:"border rounded px-3 py-1 text-sm",children:[e.jsx("option",{children:"Last 7 Days"}),e.jsx("option",{children:"Last Month"}),e.jsx("option",{children:"Last Quarter"})]})]}),e.jsx("div",{className:"rounded flex items-center justify-start",children:e.jsx(U,{data:r,orientation:"vertical"})})]})}),e.jsx("div",{className:"mt-6 bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Department Attendance"}),e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Department"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Present"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Total"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Percentage"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Progress"})]})}),e.jsx("tbody",{children:r.map((a,h)=>{var w;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:(w=a.name)==null?void 0:w.split("_").map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(" ")}),e.jsx("td",{className:"py-3 px-4",children:a.present}),e.jsx("td",{className:"py-3 px-4",children:a.total}),e.jsxs("td",{className:"py-3 px-4",children:[a.percentage,"%"]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`${a.color} h-2 rounded-full`,style:{width:`${a.percentage}%`}})})})]},h)})})]})]})})]})};export{K as default};
