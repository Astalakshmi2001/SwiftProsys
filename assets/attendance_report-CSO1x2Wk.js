import{r as N,j as e}from"./react-vendor-CHLR6qIU.js";import{u as O}from"./useAttendance-D-ZesFcA.js";import{u as g,b as Y,d as x,c as E,i as M,e as H}from"./vendor-BJwQ_dIz.js";import"./firebase-A1TrhjMY.js";import"./firebaseConfig-DYwBm8hJ.js";x.extend(E);x.extend(M);x.extend(H);function Q(){const{getAllAttendance:D}=O(),[S,k]=N.useState([]),[m,$]=N.useState(""),[b,C]=N.useState(""),A=s=>{const r={};return s.forEach(t=>{var p,y,h,f;const o=(p=t.employeeId)==null?void 0:p.trim().toLowerCase(),a=(y=t.firstName)==null?void 0:y.trim().toLowerCase(),c=x(t.date).format("YYYY-MM-DD"),d=`${o}-${a}-${c}`;r[d]||(r[d]={employeeId:(h=t.employeeId)==null?void 0:h.trim(),firstName:(f=t.firstName)==null?void 0:f.trim(),date:c,shift:t.shift,tracker:[]}),r[d].tracker.push(...t.tracker||[])}),Object.values(r).map(t=>{var w;const o=t.tracker.filter(n=>n.clockIn||n.clockOut).sort((n,l)=>new Date(`${t.date}T${n.clockIn||n.clockOut}`)-new Date(`${t.date}T${l.clockIn||l.clockOut}`));let a=0,c=null,d=null;o.forEach(({clockIn:n,clockOut:l})=>{if(n&&!c&&(c=n),l&&(d=l),n&&l){const u=new Date(`${t.date}T${n}`),i=new Date(`${t.date}T${l}`);!isNaN(u)&&!isNaN(i)&&i>u&&(a+=i-u)}});const p=a?`${String(Math.floor(a/36e5)).padStart(2,"0")}:${String(Math.floor(a%36e5/6e4)).padStart(2,"0")}:${String(Math.floor(a%6e4/1e3)).padStart(2,"0")}`:"--:--:--",y=(w=t.shift)==null?void 0:w.toLowerCase(),h={general:["08:30","09:00","09:30","10:00"],"shift-1":["06:00","07:00"],"shift-2":["13:00","14:00"]}[y];let f="Unknown";if(c&&h){const n=x(`${t.date} ${c}`,"YYYY-MM-DD HH:mm:ss");f=h.some(u=>{const i=x(`${t.date} ${u}`,"YYYY-MM-DD HH:mm"),T=i.subtract(10,"minute"),v=i.add(5,"minute");return n.isSameOrAfter(T)&&n.isSameOrBefore(v)})?"On time":"Late"}return{...t,firstClockIn:c,lastClockOut:d,totalHours:p,status:f,present:p>="06:00:00"?"Present":"Absent"}})};N.useEffect(()=>{(async()=>{try{const r=await D(),t=A(r);k(t)}catch(r){console.error("Failed to fetch attendance data:",r)}})()},[D]);const j=S.filter(s=>{var o,a;const r=m?s.date===m:!0,t=b?((o=s.employeeId)==null?void 0:o.toLowerCase().includes(b.toLowerCase()))||((a=s.firstName)==null?void 0:a.toLowerCase().includes(b.toLowerCase())):!0;return r&&t}),I=()=>{if(j.length===0){alert("No data found for selected date!");return}const s=j.map(a=>({Date:a.date,EmployeeID:a.employeeId,Name:a.firstName,Shift:a.shift,Status:a.status,ClockIn:a.firstClockIn||"--:--:--",ClockOut:a.lastClockOut||"--:--:--",TotalHours:a.totalHours,Attendance:a.present})),r=g.json_to_sheet(s),t=g.book_new();g.book_append_sheet(t,r,"Attendance");const o=`Attendance_${m||"All"}.xlsx`;Y(t,o)};return e.jsx("div",{className:"container-fluid bg-gray-100 px-0",children:e.jsxs("div",{className:"bg-white p-3 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Daily Attendance Report"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:m,onChange:s=>$(s.target.value),className:"border px-3 py-1 rounded text-sm"}),e.jsx("input",{type:"text",placeholder:"Search by name or ID...",value:b,onChange:s=>C(s.target.value),className:"border px-3 py-1 rounded text-sm"}),e.jsx("button",{onClick:I,className:"bg-green-500 text-white text-sm px-3 py-1 rounded hover:bg-green-600",children:"Export Excel"})]})]}),e.jsxs("table",{className:"w-full table-auto text-sm border border-collapse",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-3 py-2 text-left",children:"Date"}),e.jsx("th",{className:"border px-3 py-2 text-left",children:"Employee ID"}),e.jsx("th",{className:"border px-3 py-2 text-left",children:"Name"}),e.jsx("th",{className:"border px-3 py-2 text-left",children:"Shift"}),e.jsx("th",{className:"border px-3 py-2 text-left",children:"Punch In"}),e.jsx("th",{className:"border px-3 py-2 text-left",children:"Punch Out"}),e.jsx("th",{className:"border px-3 py-2 text-left",children:"Total Active Hours"}),e.jsx("th",{className:"border px-3 py-2 text-left",children:"Attendance"})]})}),e.jsx("tbody",{children:j.map((s,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border px-3 py-2",children:s.date}),e.jsx("td",{className:"border px-3 py-2",children:s.employeeId}),e.jsx("td",{className:"border px-3 py-2",children:s.firstName}),e.jsx("td",{className:"border px-3 py-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:s.shift}),e.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-white text-xs ${s.status==="Late"?"bg-red-500":"bg-blue-500"}`,children:s.status})]})}),e.jsx("td",{className:"border px-3 py-2",children:s.firstClockIn||"--:--:--"}),e.jsx("td",{className:"border px-3 py-2",children:s.lastClockOut||"--:--:--"}),e.jsx("td",{className:"border px-3 py-2",children:s.totalHours}),e.jsx("td",{className:"border px-3 py-2 font-semibold",children:s.present==="Present"?e.jsx("span",{className:"text-green-600",children:"Present"}):e.jsx("span",{className:"text-red-500",children:"Absent"})})]},r))})]})]})})}export{Q as default};
